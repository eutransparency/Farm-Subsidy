{% extends "base.html" %}
{% load humanize %}
{% load countryinfo %}
{% load parse_qs %}
{% block title %}
  Search for {{ q }}
{% endblock %}

{% block content %}

<form action="{% url search %}" method="POST" accept-charset="utf-8" id="search_form">
  <h2><label for="search" class="section_title">{{ form.q.label }}</label></h2>
  <p>
      {{ form.q }}
    <input type="submit" value="Go" class="submit">
  </p>
</form>

  <table>
    <thead>
      <th>Name</th>
      <th>Amount (All years)</th>
    </thead>
  <tbody>
    {% for result in sqs %}
    <tr class="{% cycle 'odd' 'even' %}">
      <td><a href="{{ result.object.get_absolute_url }}">{{ result.object.name }}</a></td>
      <td>&euro;{{ result.object.total|floatformat:2|intcomma }}</td>
      
    </tr>
    {% endfor %}    
  </tbody>
  </table>
{% endblock %}

{% block right %}
  <div class="block">
    <h3>Search information</h3>
    <p>Your search for <strong>{{ q }}</strong> <br />
    returned <strong>{{ results }}</strong> result{{ results|pluralize }}</p>
    <p>This page's results totals <strong>&euro;{{ total|floatformat:2|intcomma }}</strong></p>
    
    {% if sqs.facet_counts.fields.country or sqs.facet_counts.fields.scheme %}        
        <h3>Narrow your search</h3>
        {% if sqs.facet_counts.fields.country %}
            <h4>Countries:</h4>
            <ul>
            {% for country in sqs.facet_counts.fields.country %}
                <li><a href="{% parse_qs request.GET "country" country.0 %}">{% code_to_name country.0 %}</a> ({{ country.1 }} results)</li>
            {% endfor %}
            </ul>            
        {% endif %}
        {% if sqs.facet_counts.fields.scheme %}            
            <h4>Schemes:</h4>
            <ul>
            {% for scheme in sqs.facet_counts.fields.scheme %}
                <li><a href="{% parse_qs request.GET "scheme" scheme.0 %}">{{ scheme.0 }}</a> ({{ scheme.1 }} results)</li>
            {% endfor %}
            </ul>
        {% endif %}
    {% endif %}
    
    
  </div>
{% endblock %}